---
import ButtonLink from '@components/ui/ButtonLink.astro';
import Card from '@components/ui/Card.astro';
import { INPUT } from '@config/input.ts';
import { LOCALE } from '@config/locale.ts';
import { SITE } from '@config/site.ts';
import { type ThemeId, THEME } from '@config/theme.ts';
import { getLocale, getLocaleStrings } from '@i18n/index.ts';
import BaseLayout from '@layouts/BaseLayout.astro';
import { Link } from '@lucide/astro';
import { keysOf } from '@utils/index.ts';
import { getRelativeLocaleUrl } from 'astro:i18n';
import type { WithChildren } from '../../types.ts';

/**
 * Props for the social media preview image layout.
 */
type Props = WithChildren<false>;

/**
 * Generates an iframe URL with theme and placeholder text query parameters.
 *
 * @param themeId - The theme ID to apply in the preview
 * @returns A relative URL with query parameters for theme and input text
 */
function getIframePath(themeId: ThemeId) {
	return `${basePath}?${THEME.id}=${themeId}&${INPUT.id}=${msg.input.placeholder}`;
}

const themeIds: ThemeId[] = ['light', 'dark', 'teal'];
const currentLocaleId = getLocale(Astro);
const msg = getLocaleStrings(currentLocaleId);
const label = new URL(SITE.url.base).host;
const basePath = getRelativeLocaleUrl(currentLocaleId);

/**
 * Generates static paths for all supported locales.
 *
 * @returns An array of path objects with locale parameters for static site generation
 */
export function getStaticPaths() {
	return keysOf(LOCALE.map).map((localeId) => ({ params: { localeId } }));
}
---

<BaseLayout>
	<meta slot="head" name="robots" content="noindex,nofollow" />
	<main>
		<header>
			<Card>
				<ButtonLink to={SITE.url.base} {label} icon={Link} />
			</Card>
			<p>
				{msg.site.description}
			</p>
		</header>
		<section>
			{
				themeIds.map((themeId) => (
					<figure>
						{/* the scrolling attribute is deprecated, but this is by far the easiest way to hide scrollbars in an iframe */}
						<iframe scrolling="no" src={getIframePath(themeId)} />
					</figure>
				))
			}
		</section>
	</main>
</BaseLayout>

<style>
	/* Use stronger shadows than the default */
	:root {
		--s: oklch(0 0 0) !important;
	}

	main {
		display: flex;
		flex-direction: column;
		justify-content: end;
		align-items: center;
		flex: 1;
		width: 100%;
		overflow: hidden;
		font-size: calc(0.9vw + 0.9vh);
		background-image: radial-gradient(
			farthest-corner circle at 50% 100% in oklch,
			var(--bg-3),
			oklch(0% 0 0 / 0.5)
		);
	}

	header {
		display: flex;
		flex-direction: column;
		justify-content: space-evenly;
		align-items: center;
		flex: 1;
		text-align: center;
	}

	p {
		margin: 0 var(--p-lg);
		font-size: var(--f-lg);
	}

	section {
		display: flex;
		flex-direction: row;
		justify-content: center;
		align-items: end;
	}

	figure {
		--scale: 75%;
		--offset: 55%;

		flex: 1;
		height: 65vh;
		width: 40vw;
		margin-block-end: calc(-1 * var(--r-md));
		border-radius: var(--r-md);
		box-shadow: var(--s-box-lg);
		overflow: hidden;

		&:nth-of-type(1) {
			transform-origin: 100% 100%;
			transform: scale(var(--scale)) translateX(var(--offset));
		}

		&:nth-of-type(2) {
			transform-origin: 50% 100%;
			border: var(--b-md) solid var(--p);
			z-index: 1;
		}

		&:nth-of-type(3) {
			transform-origin: 0% 100%;
			transform: scale(var(--scale)) translateX(calc(-1 * var(--offset)));
		}
	}

	iframe {
		--scale: 0.55;

		width: calc(100% / var(--scale));
		height: calc(100% / var(--scale));
		border: none;
		transform-origin: 0 0;
		transform: scale(var(--scale));
	}

	@media (height >= 56rem) {
		iframe {
			--scale: 1.1;
		}
	}
</style>
