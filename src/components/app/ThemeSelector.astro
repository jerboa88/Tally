---
import HiddenInput from '@components/ui/HiddenInput.astro';
import InputGroup from '@components/ui/InputGroup.astro';
import Label from '@components/ui/Label.astro';
import { THEME } from '@config/theme.ts';
import { getLocaleMessages } from '@i18n/index.ts';
import { entriesOf } from '@utils/index.ts';
import type { WithChildren } from '../../types.ts';

/**
 * Props for the theme selector component.
 *
 * Explicitly disallows children as theme entries are generated from config.
 */
type Props = WithChildren<false>;

const msg = getLocaleMessages(Astro).themes;
---

<InputGroup id={THEME.id} title={msg.title}>
	{
		entriesOf(THEME.map).map(([id, { wip }]) => (
			<Label data-theme={id}>
				<HiddenInput
					type="radio"
					name={THEME.id}
					checked={id === THEME.default.id}
					{id}
				/>
				{msg.map[id].label}
				{wip && ' ðŸš§'}
			</Label>
		))
	}
</InputGroup>

<style>
	label {
		background: linear-gradient(
			90deg,
			var(--bg-1) 0%,
			var(--bg-1) 49.9%,
			var(--bg-2) 50.1%,
			var(--bg-2) 100%
		);
	}
</style>

<script>
	import { THEME } from '@config/theme.ts';
	import { $theme } from '@stores/index.ts';
	import { entriesOf, getDefinedElementById } from '@utils/index.ts';
	import { mapEntries } from 'radashi';

	const themeRadioMap = mapEntries(THEME.map, (themeId) => [
		themeId,
		getDefinedElementById<HTMLInputElement>(themeId),
	]);

	// Update theme radio inputs when the theme changes
	$theme.subscribe((value) => {
		if (value in themeRadioMap) {
			themeRadioMap[value].checked = true;
		} else {
			themeRadioMap[THEME.default.id].checked = true;

			$theme.set(THEME.default.id);
		}
	});

	// Update theme when a theme radio input is changed
	for (const [id, radio] of entriesOf(themeRadioMap)) {
		radio.addEventListener('change', () => $theme.set(id));
	}
</script>
