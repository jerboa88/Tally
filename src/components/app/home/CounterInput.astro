---
import Textarea from '@components/ui/Textarea.astro';
import { INPUT } from '@config/input';
import { getLocaleMessages } from '@i18n/index.ts';
import type { WithChildren } from '../../../types.ts';

/**
 * The main counter input textarea.
 */
type Props = WithChildren<false>;

const { label, placeholder } = getLocaleMessages(Astro).input;
---

<Textarea
	id={INPUT.id}
	{placeholder}
	aria-label={label}
	spellcheck="false"
	autofocus
	disabled
/>

<script>
	import { INPUT } from '@config/input.ts';
	import { $inputText } from '@stores/index.ts';
	import { getDefinedElementById } from '@utils/index.ts';
	import { debounce } from 'radashi';

	// Setting the initial textarea value is handled by the preload script on the counter page
	const updateInputText = debounce({ delay: 35 }, () =>
		$inputText.set(input.value),
	);

	const input = getDefinedElementById<HTMLTextAreaElement>(INPUT.id);

	input.addEventListener('input', updateInputText);

	input.disabled = false;
</script>
